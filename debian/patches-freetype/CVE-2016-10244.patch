From a660e3de422731b94d4a134d27555430cbb6fb39 Mon Sep 17 00:00:00 2001
From: Werner Lemberg <wl@gnu.org>
Date: Fri, 26 Aug 2016 00:23:27 +0200
Subject: [type1] Fix heap buffer overflow.

Reported as

  https://bugs.chromium.org/p/oss-fuzz/issues/detail?id=36

* src/type1/t1load.c (parse_charstrings): Reject fonts that don't
contain glyph names.
---
 ChangeLog          | 11 +++++++++++
 src/type1/t1load.c |  6 ++++++
 2 files changed, 17 insertions(+)

Index: freetype-2.6.1/src/type1/t1load.c
===================================================================
--- freetype-2.6.1.orig/src/type1/t1load.c	2017-03-16 13:38:03.594889908 -0400
+++ freetype-2.6.1/src/type1/t1load.c	2017-03-16 13:38:03.590889855 -0400
@@ -1719,6 +1719,12 @@
       }
     }
 
+    if ( !n )
+    {
+      error = FT_THROW( Invalid_File_Format );
+      goto Fail;
+    }
+
     loader->num_glyphs = n;
 
     /* if /.notdef is found but does not occupy index 0, do our magic. */
